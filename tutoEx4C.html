<html>
    <head>
        <title>ol3 - Ex4C - MyLayerSwitcher</title>
        <script type="text/javascript" src="js/config.js"></script>
        <script type="text/javascript">
            var map, lyrs;
            $(document).ready(function () {
                map = new ol.Map({
                    target: 'map',
                    layers: [
                        new ol.layer.Image({
                            source: new ol.source.ImageWMS({
                                url: blWMS,
                                params: {
                                    VERSION: "1.0.0",
                                    LAYERS: "ne_10m_admin_0_countries",
                                    FORMAT: "image/png"
                                }
                            }),
                        }),                                             
                        new ol.layer.Image({
                            source: new ol.source.ImageWMS({
                                url: mcWMS,
                                params: {
                                    VERSION: "1.1.1",
                                    LAYERS: 'public.world_simple',
                                    FORMAT: 'image/png'
                                }
                            })
                        }),
                        new ol.layer.Tile({
                            source: new ol.source.OSM()
                        }),
                        new ol.layer.Image({
                            opacity: 0.5,
                            source: new ol.source.ImageWMS({
                                url: blWMS,
                                params: {
                                    VERSION: "1.0.0",
                                    LAYERS: "ne_10m_lakes",
                                    FORMAT: "image/png"
                                }
                            }),
                        }),
                        new ol.layer.Image({
                            source: new ol.source.ImageWMS({
                                url: mcWMS,
                                params: {
                                    VERSION: "1.1.1",
                                    LAYERS: 'public.cities',
                                    FORMAT: 'image/png'
                                }
                            })
                        })                        
                    ]
                });
                map.getView().setCenter(ol.proj.transform([7, 47], "EPSG:4326", "EPSG:3857"))
                map.getView().setZoom(5);

                initMyLayerSwitcher();
            });
            
            /***
             * initMyLayerSwitcher: a first attempt to manage baselayers and overlayers.
             * 
             * Remark: in the current state, the main drawback is that it is absolutly 
             * not flexible and adaptative!
             * 
             * @returns {undefined}
             */
            function initMyLayerSwitcher(){
                lyrs = map.getLayers().getArray();
                
                // Set visibility of the baselayer
                lyrs[0].setVisible(true);
                lyrs[1].setVisible(false);
                lyrs[2].setVisible(false);
                
                // Set visibility of the overlays
                lyrs[3].setVisible(false);
                lyrs[4].setVisible(false);
                $('#overlay option').prop('selected', false);

                // Define the callback when the user does change the baselayer
                $("#base").change(function (e) {
                    // Reset all baselayers
                    lyrs[0].setVisible(false);
                    lyrs[1].setVisible(false);
                    lyrs[2].setVisible(false);

                    // Activate the one that is selected (based on index)
                    var idxVisible = $(this).find(":selected").index();
                    lyrs[idxVisible].setVisible(true);
                });

                // Define the callback when the user does change the overlays
                $("#overlay").change(function (e) {
                    $(this).find("option").each(function (i, e) {
                        // i + 3 because the 1st, 2nd and 3rd elements in the table of layers are the baselayers
                        lyrs[i + 3].setVisible(e.selected);
                    });
                });                
            }
        </script>

        <style type="text/css">
            #map {
                width: 80%;
                height: 100%;
            }
            #switcher {
                position: absolute;
                left: 82%;
                top: 2%;
            }
        </style>
    </head>
    <body>
        <div id="map"></div>
        
        <div id="switcher">
            <p>Choose baselayer:</p>
            <select id="base">
                <option value="base1">Countries</option>
                <option value="base2">World simple</option>
                <option value="base3">OSM</option>
            </select>
            <p>Choose overlays:</p>
            <select id="overlay" size="2" multiple>
                <option value="overlay1">Lakes</option>
                <option value="overlay2">Cities</option>
            </select>        
        </div>
    </body>
</html>