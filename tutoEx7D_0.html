<html>
    <head>
        <title>Ex7D - Vector overlay loading strategies</title>
        <script type="text/javascript" src="js/config.js"></script>
        <script type="text/javascript">
            var map;
            $(document).ready(function () {
                map = new ol.Map({
                    target: 'map',
                    view: new ol.View({
                        center: ol.proj.transform([8, 47], "EPSG:4326", "EPSG:3857"),
                        zoom: 5
                    })
                });

                var osmLayer = new ol.layer.Tile({
                    source: new ol.source.OSM(),
                    opacity: 0.3
                });
                map.addLayer(osmLayer);

                var vectorSource = new ol.source.Vector({
                    loader: function (extent, resolution, projection) {
                        // Web Feature Service parameters
                        url = unWFS + "?" + $.param({
                            service: 'WFS',
                            version: '1.1.0',
                            request: 'GetFeature',
                            typename: 'Cities_esri',
                            srsname: 'EPSG:3857'
                        });

                        // Pass it through the proxy
                        $.ajax({
                            url: "php/proxy1.php?url=" + url,
                            dataType: 'xml',
                            success: function (response) {
                                var wfsFormat = new ol.format.WFS();
                                vectorSource.addFeatures(wfsFormat.readFeatures(response));
                            },
                            error: function (jqXHR, textStatus, errorThrown) {
                                alert("The request has failed: " + textStatus + errorThrown);
                            }
                        });
                    },
                    strategy: ol.loadingstrategy.all,
                    projection: "EPSG:3857"
                });

                var lyr = new ol.layer.Vector({
                    source: vectorSource
                })
                map.addLayer(lyr)
            })
        </script>

        <style type="text/css">
            #map {
                width: 100%;
                height: 100%;
            }
        </style>
    </head>
    <body>
        <div id="map"></div>
        <div id="info"></div>
    </body>
</html>